$(function () {
    // Remove loader immediately
    $('#loader').fadeOut(250);

    // Make all sections and content visible immediately
    $('.header, .sec').css({
        opacity: '1',
        visibility: 'visible',
    });

    // Ensure all sections are active and visible
    $('.sec').addClass('active');

    // Show all menu content
    $('.sec_menulist .tab_cont').css({
        opacity: '1',
        visibility: 'visible',
        display: 'block',
    });

    // Mobile menu handling
    $('#btn_gnav').on('click', function (e) {
        e.preventDefault();
        e.stopPropagation();

        $(this).toggleClass('active');

        if ($(this).hasClass('active')) {
            $('#wrap_gnav').fadeIn(300);
            $('body').css('overflow', 'hidden');
            $('.header').addClass('menu-open');
        } else {
            $('#wrap_gnav').fadeOut(300);
            $('body').css('overflow', '');
            $('.header').removeClass('menu-open');
        }
    });

    // Close menu when clicking on a link
    $('#wrap_gnav a').on('click', function (e) {
        $('#btn_gnav').removeClass('active');
        $('#wrap_gnav').fadeOut(300);
        $('body').css('overflow', '');
        $('.header').removeClass('menu-open');
    });

    // Cache header height and scroll variables
    var headerHeight = $('.header').height();
    var lastScrollTop = 0;
    var scrollThreshold = 50;
    var isHeaderVisible = true;

    // Single scroll handler for header behavior
    function handleScroll() {
        if ($('#btn_gnav').hasClass('active')) return;

        var currentScrollTop = $(window).scrollTop();
        var scrollDelta = Math.abs(currentScrollTop - lastScrollTop);

        // Only trigger header hide/show on significant scroll
        if (scrollDelta > 10) {
            // Scrolling down
            if (currentScrollTop > lastScrollTop && currentScrollTop > scrollThreshold) {
                $('.header').addClass('scroll hide');
                isHeaderVisible = false;
            }
            // Scrolling up
            else {
                $('.header').removeClass('hide');
                if (currentScrollTop <= scrollThreshold) {
                    $('.header').removeClass('scroll');
                } else {
                    $('.header').addClass('scroll');
                }
                isHeaderVisible = true;
            }
        }

        lastScrollTop = currentScrollTop;
    }

    // Throttled scroll event
    var scrollTimeout;
    $(window).on('scroll', function () {
        if (!scrollTimeout) {
            scrollTimeout = setTimeout(function () {
                handleScroll();
                scrollTimeout = null;
            }, 10);
        }
    });

    // Initialize sliders
    $('.sec_home .wrap_bg, .sec_shopinfo .wrap_bg').slick({
        dots: false,
        arrows: false,
        slidesToShow: 1,
        autoplay: true,
        autoplaySpeed: 3000,
        speed: 1500,
        fade: true,
        pauseOnHover: false,
        responsive: [
            {
                breakpoint: 768,
                settings: {
                    adaptiveHeight: true,
                },
            },
        ],
    });

    // Menu tab handlers with mobile optimization
    function handleMenuTab(index) {
        $('.sec_menulist .tab_cont').hide().eq(index).fadeIn(500);
        $('.sec_menulist .tab_nav01, .sec_menulist .tab_nav02').removeClass('active');
        $('.sec_menulist .tab_nav01').eq(index).addClass('active');
        $('.sec_menulist .tab_nav02').eq(index).addClass('active');

        // Scroll to content on mobile
        if ($(window).width() < 768) {
            $('html, body').animate(
                {
                    scrollTop: $('.sec_menulist .tab_cont').eq(index).offset().top - 60,
                },
                500
            );
        }
    }

    // Menu tab click handlers
    $('.sec_menu .tab_nav, .sec_menulist .tab_nav01, .sec_menulist .tab_nav02').on('click', function (e) {
        e.preventDefault();
        var index = $(this).parent().index();
        handleMenuTab(index);
    });

    // Show first menu tab by default
    handleMenuTab(0);

    // Handle window resize
    var resizeTimeout;
    $(window).on('resize', function () {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function () {
            if ($(window).width() >= 768) {
                $('body').css('overflow', '');
                $('#wrap_gnav').hide();
                $('#btn_gnav').removeClass('active');
                $('.header').removeClass('menu-open');
            }
        }, 250);
    });

    // Trigger initial scroll check
    handleScroll();
});
